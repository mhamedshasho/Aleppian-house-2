<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>الرسائل - بيت حلبي</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <a href="index.html" class="logo">
      <img src="logo.png" alt="شعار بيت حلبي">
      <span class="site-name">بيت حلبي</span>
    </a>
    <nav>
      <a href="dashboard.html">لوحة التحكم</a>
      <a href="index.html">الرئيسية</a>
      <a href="#" onclick="logout()">تسجيل الخروج</a>
    </nav>
  </header>

  <div class="container">
    <!-- نموذج إرسال رسالة -->
    <div class="card">
      <h3>✉️ إرسال رسالة جديدة</h3>
      <input type="email" id="to" placeholder="إلى (البريد الإلكتروني)" required>
      <textarea id="message" placeholder="اكتب رسالتك هنا..." required></textarea>
      <button onclick="sendMessage()">إرسال</button>
    </div>

    <!-- عرض الرسائل الواردة -->
    <div class="card">
      <h3>📥 الرسائل الواردة</h3>
      <div id="inbox"></div>
    </div>
  </div>

  <script>
    function sendMessage() {
      const to = document.getElementById("to").value.trim();
      const msg = document.getElementById("message").value.trim();
      const from = localStorage.getItem("currentUserEmail") || "مستخدم مجهول";

      if (!to || !msg) {
        alert("يرجى ملء جميع الحقول");
        return;
      }

      const messages = JSON.parse(localStorage.getItem("messages")) || [];
      messages.push({ from, to, msg, date: new Date().toLocaleString() });
      localStorage.setItem("messages", JSON.stringify(messages));

      alert("✅ تم إرسال الرسالة");
      document.getElementById("to").value = "";
      document.getElementById("message").value = "";
      loadInbox();
    }

    function loadInbox() {
      const currentUser = localStorage.getItem("currentUserEmail");
      const messages = JSON.parse(localStorage.getItem("messages")) || [];
      const inboxMessages = messages.filter(m => m.to === currentUser);

      const inboxDiv = document.getElementById("inbox");
      if (inboxMessages.length > 0) {
        inboxDiv.innerHTML = inboxMessages.map(m => `
          <div style="border-bottom:1px solid #ccc; padding:5px 0;">
            <p><strong>من:</strong> ${m.from}</p>
            <p>${m.msg}</p>
            <small>${m.date}</small>
          </div>
        `).join("");
      } else {
        inboxDiv.innerHTML = "<p>لا توجد رسائل حالياً.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", loadInbox);
  </script>
</body>
</html>
